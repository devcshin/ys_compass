<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì„œìš¸ì‹œì²­ ë‚˜ì¹¨ë°˜</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin-top: 50px;
    }
    #arrow {
      font-size: 100px;
      display: inline-block;
      transition: transform 0.2s linear;
    }
  </style>
</head>
<body>
  <h1>ì„œìš¸ì‹œì²­ ë°©í–¥ ë‚˜ì¹¨ë°˜</h1>
  <div id="arrow">ğŸ§­</div>
  <p id="status">ìœ„ì¹˜ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>

  <script>
    const partnerLat = 37.5665;  // ì„œìš¸ì‹œì²­ ìœ„ë„
    const partnerLon = 126.9780; // ì„œìš¸ì‹œì²­ ê²½ë„
    let myLat = null, myLon = null;

    // ë°©ìœ„ê° ê³„ì‚° í•¨ìˆ˜
    function getBearing(lat1, lon1, lat2, lon2) {
      const dLon = (lon2 - lon1) * Math.PI / 180;
      lat1 = lat1 * Math.PI / 180;
      lat2 = lat2 * Math.PI / 180;

      const y = Math.sin(dLon) * Math.cos(lat2);
      const x = Math.cos(lat1) * Math.sin(lat2) -
                Math.sin(lat1) * Math.cos(lat2) * Math.cos(dLon);
      return (Math.atan2(y, x) * 180 / Math.PI + 360) % 360;
    }

    // ë‚´ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
    navigator.geolocation.getCurrentPosition((pos) => {
      myLat = pos.coords.latitude;
      myLon = pos.coords.longitude;
      document.getElementById("status").innerText = "ì„œìš¸ì‹œì²­ ë°©í–¥ì„ í‘œì‹œí•©ë‹ˆë‹¤!";
    }, (err) => {
      document.getElementById("status").innerText = "ìœ„ì¹˜ ì ‘ê·¼ ë¶ˆê°€: " + err.message;
    });

    // ê¸°ê¸° ë°©í–¥ ì´ë²¤íŠ¸ (ë¶ìª½ 0Â° ê¸°ì¤€)
    window.addEventListener("deviceorientationabsolute", (event) => {
      if (!myLat || !myLon) return;

      let heading = event.alpha; // ë‹¨ìœ„: ë„(degree), 0~360
      if (heading === null) {
        document.getElementById("status").innerText = "ë‚˜ì¹¨ë°˜ ì„¼ì„œ ì§€ì› ì•ˆí•¨";
        return;
      }

      // ì„œìš¸ì‹œì²­ ë°©ìœ„ê°
      let bearing = getBearing(myLat, myLon, partnerLat, partnerLon);
      let angle = (bearing - heading + 360) % 360;

      // í™”ì‚´í‘œ íšŒì „
      document.getElementById("arrow").style.transform = `rotate(${angle}deg)`;
    });

    // iOS Safari ê¶Œí•œ ìš”ì²­ (iOS13+)
    document.body.addEventListener("click", () => {
      if (typeof(DeviceOrientationEvent) !== "undefined" &&
          typeof(DeviceOrientationEvent.requestPermission) === "function") {
        DeviceOrientationEvent.requestPermission().then((response) => {
          if (response === "granted") {
            document.getElementById("status").innerText = "ë‚˜ì¹¨ë°˜ ê¶Œí•œ í—ˆìš©ë¨";
          } else {
            document.getElementById("status").innerText = "ë‚˜ì¹¨ë°˜ ê¶Œí•œ ê±°ë¶€ë¨";
          }
        });
      }
    });
  </script>
</body>
</html>
